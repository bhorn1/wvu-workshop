<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../services/wvu.html">
<link rel="import" href="./todo-item.html">
<link rel="import" href="./todo-input.html">

<dom-module id="todo-app">
    <template>
        <dom-repeat items="[[todos]]">
            <template>
                <todo-item todo="[[item]]" on-save-todo="_saveTodo" on-delete-todo="_deleteTodo"></todo-item>
            </template>
        </dom-repeat>
        <todo-input on-create-todo="_createTodo"></todo-input>
    </template>
    <script>
        class TodoApp extends Polymer.Element {
            static get is() {
                return "todo-app";
            }

            static get properties() {
                return [{
                    todos: Array,
                }];
            }

            constructor() {
                super();
                this._loadAll();
            }

            async _loadAll() {
                this.todos = await WVU.todoService.getAll();
            }

            async _deleteTodo(e) {
                await WVU.todoService.delete(e.model.item.id);
                this.splice("todos", e.model.index, 1);
            }

            async _saveTodo(e) {
                this.set(["todos", e.model.index], await WVU.todoService.update(e.model.item));
            }

            async _createTodo(e) {
                this.push("todos", await WVU.todoService.create(e.detail));
            }
        }
customElements.define(TodoApp.is, TodoApp);
    </script>
</dom-module>
